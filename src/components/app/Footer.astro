---
import { getImage } from 'astro:assets';
import FloatingInput from '@/components/ui/FloatingInput.astro';
import Button from '@/components/starwind/button';
import FacebookIcon from '@/icons/facebook.svg';
import InstagramIcon from '@/icons/instagram.svg';
import LinkedinIcon from '@/icons/linkedin.svg';
import YouTubeIcon from '@/icons/youtube.svg';
import Logo from '@/icons/logo.svg';
import BezazelLogo from '@/icons/bezazel.svg';

const { socials } = await import('@/data/site_settings.json');
const background = await getImage({ src: import('@/assets/footer-bg.png'), format: 'avif' });

const socialLinks = [
  { name: 'Facebook', icon: FacebookIcon, href: socials.facebook },
  { name: 'Instagram', icon: InstagramIcon, href: socials.instagram },
  { name: 'Linkedin', icon: LinkedinIcon, href: socials.linkedin },
  { name: 'YouTube', icon: YouTubeIcon, href: socials.youtube }
];
---

<footer class="relative bg-cover bg-no-repeat bg-top pt-15 lg:pt-20 pb-6 text-white" style={{ backgroundImage: `url(${background.src})` }}>
  <div class="w-full h-full absolute top-0 left-0 bg-black/25"></div>
  <div class="container z-2 relative">
    <p class="font-semibold mb-5 lg:mb-6 uppercase">Looking for something else?</p>
    <h2 class="section-title text-white mb-5">Talk with a product specialist</h2>
    <p class="max-w-[570px] mb-10 lg:mb-15">If you don’t see what you’re looking for, the best thing to do is give us a quick call or fill out the following inquiry form. We carry all essential roofing materials, so you’re probably covered!</p>

    <form id="footer-contact-form" class="grid md:grid-cols-2 gap-4 md:gap-x-5 md:gap-y-7.5 mb-15 lg:mb-30" onsubmit="event.preventDefault(); handleFooterFormSubmit(event)">
      <FloatingInput label="Name" placeholder="Name" id="name" name="name" required />
      <FloatingInput label="Phone" placeholder="Phone" id="phone" name="phone" required />
      <FloatingInput label="Inquiry" placeholder="Inquiry" id="inquiry" name="inquiry" required />
      <Button type="submit" id="footer-submit-btn">
        <span id="submit-text">Send</span>
        <span id="submit-spinner" class="hidden">Sending...</span>
      </Button>
    </form>

    <div class="flex flex-col lg:flex-row justify-between items-start gap-10 md:gap-20 2xl:gap-40 mb-12.5">
      <div class="flex gap-2.5">
        {
          socialLinks.map(
            (link) =>
              link.href && (
                <a href={link.href} target="_blank" class="w-11.25 h-11.25 grid place-items-center border border-white rounded-full hover:bg-primary transition-colors hover:border-transparent">
                  <link.icon />
                </a>
              )
          )
        }
      </div>

      <div class="grid grid-cols-2 gap-10 md:flex md:gap-20">
        <!-- PRODUCTS -->
        <div>
          <h2 class="text-lg font-semibold mb-4 uppercase">CATALOG</h2>
          <ul class="space-y-2">
            <li class="underline-hover w-fit"><a href="/products/" class="transition-colors">Residential Products</a></li>
            <li class="underline-hover w-fit"><a href="/products/" class="transition-colors">Commercial Roofing Products</a></li>
            <li class="underline-hover w-fit"><a href="/products/" class="transition-colors">Other Products</a></li>
          </ul>
        </div>

        <!-- SERVICES -->
        <div>
          <h2 class="text-lg font-semibold mb-4 uppercase">ABOUT US</h2>
          <ul class="space-y-2">
            <li class="underline-hover w-fit"><a href="/about/#early-beginnings" class="transition-colors">Early Beginnings</a></li>
            <li class="underline-hover w-fit"><a href="/about/#our-milestones" class="transition-colors">Our Milestones</a></li>
            <li class="underline-hover w-fit"><a href="/about/#3-pillars-of-riverside" class="transition-colors">3 Pillars of Riverside</a></li>
            <li class="underline-hover w-fit"><a href="/about/#mission-and-vision" class="transition-colors">Mission and Vision</a></li>
            <li class="underline-hover w-fit"><a href="/about/#get-to-know-our-team" class="transition-colors">Get to Know Our Team</a></li>
            <li class="underline-hover w-fit"><a href="/about/#join-our-team" class="transition-colors">Join the Team</a></li>
          </ul>
        </div>

        <!-- RESOURCES -->
        <div>
          <h2 class="text-lg font-semibold mb-4 uppercase">Services</h2>
          <ul class="space-y-2">
            <li class="underline-hover w-fit"><a href="/faq" class="transition-colors">FAQ</a></li>
            <li class="underline-hover w-fit"><a href="/reviews" class="transition-colors">Reviews</a></li>
            <li class="underline-hover w-fit"><a href="/blog" class="transition-colors">Blog</a></li>
            <li class="underline-hover w-fit"><a href="/contact" class="transition-colors">Contact</a></li>
          </ul>
        </div>

        <!-- COMPANY -->
        <div>
          <h2 class="text-lg font-semibold mb-4 uppercase">Contact</h2>
          <ul class="space-y-7.5">
            <li class="underline-hover"><a href="mailto:info@riversideroofingmaterials.com" class="transition-colors wrap-anywhere">info@riversideroofingmaterials.com</a></li>
            <li class="flex flex-col">
              <a href="tel:3182229999" class="mb-2 underline-hover w-fit">P: 318-222-9999</a>
              <a href="tel:3182225050" class="underline-hover w-fit">F: 318-222-5050</a>
            </li>
            <li>
              <p class="mb-2">975 Louisiana Avenue</p>
              <p>Shreveport, LA, 71101</p>
            </li>
            <li>
              <div class="mb-4">
                <p class="font-semibold mb-2">MONDAY - FRIDAY</p>
                <p>7:00 am - 4:00 pm</p>
              </div>
              <div>
                <p class="font-semibold mb-2">SATURDAY AND SUNDAY</p>
                <p>Closed</p>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <Logo class="max-w-full h-[135px] md:h-[216px] lg:h-auto" />

    <div class="flex flex-col sm:flex-row sm:items-center gap-5 justify-between mt-10">
      <p>Copyright © 2025. All Rights Reserved</p>

      <div class="flex gap-2 items-center">
        <a href="https://www.bezalelab.com/" target="_blank"><BezazelLogo fill="white" /></a>
        <a href="#" class="font-medium">Terms of Use</a>
      </div>
    </div>
  </div>
</footer>

<script>
  import { toast } from 'sonner';

  async function handleFooterFormSubmit() {
    const form = document.getElementById('footer-contact-form') as HTMLFormElement;
    const submitBtn = document.getElementById('footer-submit-btn') as HTMLButtonElement | null;
    const submitText = document.getElementById('submit-text');
    const submitSpinner = document.getElementById('submit-spinner');

    if (!submitBtn || !submitText || !submitSpinner) {
      console.error('Form elements not found');
      return;
    }

    // Show loading state
    submitBtn.disabled = true;
    submitText.classList.add('hidden');
    submitSpinner.classList.remove('hidden');

    try {
      const formData = new FormData(form);
      const response = await fetch('/api/send-footer-form', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          name: formData.get('name'),
          phone: formData.get('phone'),
          inquiry: formData.get('inquiry')
        })
      });

      if (!response.ok) {
        throw new Error('Failed to send message');
      }

      toast.success('Thank you! Your message has been sent.');
      form.reset();
    } catch (error) {
      console.error('Error:', error);
      toast.error('Sorry, there was an error sending your message. Please try again later.');
    } finally {
      if (submitBtn && submitText && submitSpinner) {
        submitBtn.disabled = false;
        submitText.classList.remove('hidden');
        submitSpinner.classList.add('hidden');
      }
    }
  }
  document.getElementById('footer-contact-form')?.addEventListener('submit', handleFooterFormSubmit);
</script>
